#!/usr/bin/env python3

import argparse
import socket
import sys
import threading

parser = argparse.ArgumentParser(description='Run a simple message client.')
parser.add_argument('host', help='ip address of host server')
parser.add_argument('port', type=int, help='port of host server')
parser.add_argument('--buffer-size', '-b', type=int, default=1024, help='size (in bytes) of buffer')
config = parser.parse_args()


def run_client_writable():
    while 1:
        print('[me]', end=' ')
        msg = input()
        if msg == 'q':
            break
        s.send(msg.encode())

    s.close()
    print("Connection closed")


def run_client_readable():
    while 1:
        data = s.recv(config.buffer_size)
        if data is None:
            break
        print('\r[quotes] %s\n[me]' % (data.decode('utf-8')), end=' ')
        sys.stdout.flush()


s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((config.host, config.port))


t = threading.Thread(target=run_client_readable, args=[])
t.daemon = True
t.start()
run_client_writable()
sys.exit()
